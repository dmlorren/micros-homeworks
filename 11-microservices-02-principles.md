
# Домашнее задание к занятию «Микросервисы: принципы» - Иванов Дмитрий (fops-13)

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.


### Ответ:


Сравнительная таблица решений на основании решений представленных в сети:

| Решение                | Маршрутизация                       | Аутентификация                    | HTTPS терминация | Дополнительные возможности                  | Поддержка вертикального масштабирования |
|-----------------------|-------------------------------------|-----------------------------------|-------------------|---------------------------------------------|---------------------------------------|
| **Kong**              | Да                                  | JWT, OAuth2                       | Да                | Плагины для мониторинга, логирования       | Да                                    |
| **Traefik**           | Да                                  | Basic Auth, JWT                   | Да                | Автоконфигурация с Docker и Kubernetes     | Да                                    |
| **AWS API Gateway**   | Да                                  | IAM, Cognito                      | Да                | Интеграция с AWS экосистемой               | Да                                    |
| **Nginx**             | Да, но с ручным управлением        | Ограниченная через модули        | Да                | Высокая производительность, кэширование    | Да                                    |
| **API Umbrella**      | Да                                  | API Key, OAuth                    | Да                | Мониторинг, управление API                  | Ограниченная                           |


#### 1. Kong
- Маршрутизация: Поддерживает динамическую маршрутизацию на основе конфигурации. Механизмы маршрутизации позволяют направлять запросы к разным сервисам в зависимости от URL, заголовков и других параметров.
- Аутентификация: Поддерживает различные схемы аутентификации, включая JWT и OAuth2, что гарантирует безопасность и гибкость.
- HTTPS терминация: Позволяет настраивать терминацию HTTPS непосредственно на уровне API Gateway, что улучшает безопасность данных на уровне транспорта.

#### 2. Traefik
- Маршрутизация: Поддерживает автоматическую маршрутизацию с помощью конфигураций, которые можно описывать в файлах или путем изменения метаданных в самом сервисе.
- Аутентификация: Поддерживает Basic Auth и JWT, но менее уведомлен о полноте и гибкости, чем Kong.
- HTTPS терминация: Имеет встроенную поддержку терминации HTTPS, что позволяет быстро настроить безопасный доступ.

#### 3. AWS API Gateway
- Маршрутизация: Позволяет настраивать маршруты через веб-консоль AWS или инфраструктуру как код (CloudFormation, SAM).
- Аутентификация: Интеграция с Amazon IAM и AWS Cognito обеспечивает высокий уровень аутентификации и авторизации.
- HTTPS терминация: Поддерживает терминацию HTTPS и управляемое SSL-сертификаты через AWS Certificate Manager.

#### 4. Nginx
- Маршрутизация: Поддерживает маршрутизацию через конфигурацию, но требует больше ручного управления для сложных схем.
- Аутентификация: Не имеет встроенных средств аутентификации. Может быть расширен модулями, но потребует дополнительного кода или конфигурации.
- HTTPS терминация: Имеет отличную поддержку для терминации HTTPS, но требует ручной настройки для оптимизации.

#### 5. API Umbrella
- Маршрутизация: Позволяет настраивать маршруты через веб-интерфейс и поддерживает сложные правила. 
- Аутентификация: Поддерживает API Key и OAuth, но может быть не столь гибким, как другие варианты.
- HTTPS терминация: Имеет поддержку терминации HTTPS, но с большей сложностью настройки.

<u>Подчёркнутый текст</u>

## Вывод

Предполагаю выбрать kong будет наилучшем решением, удачная связка: <u>динамическая маршрутизация на основе конфигурации</u> + <u>поддержка плагинов</u> + <u>производительность и масштабируемость</u> + <u>сообщество и документация</u>

Из плюсов у Kong имеет есть бесплатная версия с открытым исходным кодом (и коммерческая версия с дополнительными возможностями).

Подробное описание выбора:
```
1. Гибкость и мощность: Kong предоставляет отличные возможности для маршрутизации и поддерживает множество схем аутентификации. Это важно для обеспечения безопасности и управления доступом к микросервисам

2. Поддержка плагинов: Широкий выбор доступных плагинов для мониторинга, управления трафиком и логирования позволяет глубже интегрировать Kong в существующую инфраструктуру и оптимизировать повседневные операции.

3. Производительность и масштабируемость: Kong обладает высокой производительностью и предоставляет возможности для масштабирования, что особенно важно для микросервисной архитектуры с переменной нагрузкой.

4. Сообщество и поддержка: У Kong активное сообщество и хорошая документация, что упрощает решение возможных проблем и внедрение новых функций.
```


## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.





### Ответ:


## Сравнительный анализ брокеров сообщений

#### 1. Apache Kafka
- Кластеризация: Полная поддержка кластеризации, обеспечивающая высокую доступность и отказоустойчивость.
- Хранение сообщений: Сообщения хранятся на диске, что позволяет восстанавливать их при сбоях и обеспечивает долгосрочное хранилище.
- Скорость работы: Высокая скорость работы, поддерживает миллионы сообщений в секунду за счёт использования порционного и распределенного логирования.
- Форматы сообщений: Поддерживает различные форматы, такие как JSON, Avro, Protobuf и др.
- Разделение прав доступа: Поддержка ACL для управления доступом к темам.
- Простота эксплуатации: Требует определённой настройки, но есть множество инструментов для мониторинга и управления.

#### 2. RabbitMQ
- Кластеризация: Поддерживает кластеризацию для повышения надежности, но с большей сложностью конфигурации по сравнению с Kafka.
- Хранение сообщений: Хранит сообщения на диске для обеспечения надежной доставки, поддерживает различные уровни подтверждения доставки.
- Скорость работы: Поддерживает высокую дельту сообщений, но может быть менее производительным при очень больших объёмах нагрузки по сравнению с Kafka.
- Форматы сообщений: Поддерживает различные форматы (JSON, XML и уйдут другие) через плагины.
- Разделение прав доступа: Поддержка сложных правил авторизации и аутентификации.
- Простота эксплуатации: Простая установка и управление с веб-интерфейсом, множество документации.

#### 3. ActiveMQ
- Кластеризация: Поддерживает кластеризацию, но с ограничениями по производительности в больших распределенных системах.
- Хранение сообщений: Сообщения могут храниться на диске, что позволяет избежать потерь на случай сбоя.
- Скорость работы: Производительность приемлема, но недостаточно высока для очень высоких нагрузок.
- Форматы сообщений: Поддерживает JMS и различные форматы сообщений, включая JSON и XML.
- Разделение прав доступа: Уровни безопасности гибкие, поддерживает ACL.
- Простота эксплуатации: Можно управлять через веб-интерфейс и консольные инструменты, но может быть сложным в настройке.

#### 4. Redis (в роли брокера сообщений)
- Кластеризация: Поддерживает кластеризацию и репликацию, что обеспечивает высокую доступность.
- Хранение сообщений: В основном хранит сообщения в памяти, с возможностью персистенции на диск, но не основной функционал для потоков.
- Скорость работы: Высокая скорость, подходит для ситуаций с низкой латентностью.
- Форматы сообщений: Поддерживает текстовые и бинарные данные, но форматы сообщений ограничены (чаще всего строки).
- Разделение прав доступа: Базовые механизмы авторизации, но меньше возможностей для управления раздельными потоками.
- Простота эксплуатации: Очень прост в настройке и эксплуатации, много инструментов для мониторинга.

#### 5. NATS
- Кластеризация: Поддерживает кластеризацию и обеспечивает высокую доступность.
- Хранение сообщений: Быстрое хранение сообщений в памяти, с возможностью персистенции (но это не основное направление).
- Скорость работы: Высокая скорость обработки сообщений, подходит для низколатентных приложений.
- Форматы сообщений: Текстовые и бинарные данные без ограничений формата.
- Разделение прав доступа: Поддержка базовой аутентификации и ACL.
- Простота эксплуатации: Легкая в настройке и эксплуатации, хорошо подходит для небольших и средних систем.


## Сравнительная таблица возможностей

| Брокер                | Кластеризация | Хранение сообщений | Скорость работы | Форматы сообщений         | Разделение прав доступа | Простота эксплуатации       |
|----------------------|----------------|---------------------|------------------|---------------------------|------------------------|------------------------------|
| **Apache Kafka**      | Да             | Да                  | Очень высокая    | JSON, Avro, Protobuf      | Да                     | Средняя                      |
| **RabbitMQ**          | Да             | Да                  | Высокая          | JSON, XML и другие       | Да                     | Высокая                     |
| **ActiveMQ**          | Да             | Да                  | Умеренная        | JMS, JSON, XML            | Да                     | Средняя                      |
| **Redis**             | Да             | В основном в памяти | Очень высокая    | Ограниченные форматы     | Ограниченная            | Очень высокая                |
| **NATS**              | Да             | В основном в памяти | Высокая          | Неограниченные форматы    | Базовая                | Высокая                      |


## Вывод

Наиболее подходящим решением я вижу kafk'у. Мы будем иметь <u>кластеризацию и поддержку хранения сообщений на диске</u> + <u>производительность и низкую латентность</u> (хорошо для высокопроизводительных систем) + <u>разнообразные форматы сообщений</u> + <u>разделение прав доступа</u> + <u>мониторинг</u>. 

По нескольким пунктам кафка уступает другим продуктам, но это компенсируется за счёт тонкой и гибкой настройки.


Подробное описание выбора:
```
1. Надежность и отказоустойчивость: Поддержка кластеризации и хранения сообщений на диске позволяет обеспечить высокую надежность и восстановление данных в случае сбоя.
  
2. Высокая производительность: Kafka способна обрабатывать миллионы сообщений в секунду и обеспечивает низкую латентность, что делает её идеальной для высоконагруженных систем.

3. Поддержка различных форматов: Возможность использования различных форматов сообщений позволяет легко интегрироваться с различными системами.

4. Разделение прав доступа: Поддержка ACL делает Kafka гибким и безопасным решением для распределенных систем.

5. Мониторинг и управление: Хотя может потребовать некоторой настройки, существуют мощные инструменты и экосистема вокруг Kafka для мониторинга и управления.
```

---